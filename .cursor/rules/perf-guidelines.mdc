---
globs: trace_viewer/*.py
---
# 性能与线程使用规范（Trace Viewer）

- 耗时操作（解析、寄存器复原、链路构建、内存求址）必须放在后台线程执行。
- 启动新线程前，应中断并 `wait(50-200ms)` 等待旧线程退出，避免 `QThread` 销毁时仍在运行。
- UI 更新只在主线程完成；线程完成后通过信号回传结果。
- 交互节流：连续点击同一组件建议加≥80ms 节流，避免事件风暴。
- 复原优化：优先从最近缓存事件状态增量回放，使用 `_regs_cache` 命中再扩展。
